---
title: "metaRbolomics dependencies"
author: "Steffen Neumann"
date: "August 26, 2016"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options("repos" = list(CRAN="http://cran.rstudio.com/"))

library(miniCRAN)
library(igraph)
library(magrittr)
library(networkD3)

source("miniMetabolomicsHelper.R")

# reproducible / predictable random numbers
set.seed(1)

```

First of all, we need to obtain a list of packages, and their DESCRIPTIONS,
to learn about dependencies between the packages, and also their purpose:

```{r package information}

apkgs <- biocPackages()

viewPkgs <- packagesInView("Metabolomics",
                       url="http://www.bioconductor.org/packages/devel/bioc/VIEWS")

descriptions <- getBioCDescriptions(viewPkgs)

dg <- makeDepGraph(viewPkgs, availPkgs=apkgs,
                   suggests = FALSE, enhances = FALSE)

```


If you want to know what the packages in the metabolomics view 
are about, check out the wordle created from all the Descriptions:

```{r wordle}


library(tm)
library(wordcloud)

corpus <- VCorpus(VectorSource(descriptions))
corpus <- tm_map(corpus, content_transformer(stripWhitespace))
corpus <- tm_map(corpus, content_transformer(tolower))
corpus <- tm_map(corpus, content_transformer(removeWords), stopwords("english"))
corpus <- tm_map(corpus, content_transformer(stemDocument))

wordcloud(corpus, scale=c(5,0.5), max.words=100, random.order=FALSE, rot.per=0.35, use.r.layout=FALSE, colors=brewer.pal(8, "Dark2"))

```


```{r dependenciesStatic}

plot(dg, 
     pkgsToHighlight=viewPkgs,
     legendPosition = c(-1, -1), 
     main="Static dependency graph",
     vertex.size=10, cex=0.7)


```

```{r dependenciesDynamic}

library(networkD3)
library(visNetwork)
library(magrittr)

V(dg)$size <- degree(dg)

gd <- get.data.frame(dg, what = "both" )
nodes <- with(gd[["vertices"]],
              data.frame(
                id =  name,
                size =  size
              ))

visNetwork(
  nodes = nodes, 
  edges = gd[["edges"]],
  height = 500,
  width = "100%"
) %>% 
  visPhysics(timestep = 0.03) %>% 
  visOptions(highlightNearest = TRUE)

```

Once you have the dependency graph, you can use the `page.rank` 
from the `igraph` package, to determine how connected a package is,
i.e. how many other packages (directly) depend on it.

```{r pageRank}
pr <- dg %>%
  page.rank(directed = FALSE) %>%
  use_series("vector") %>%
  sort(decreasing = TRUE) %>%
  as.matrix %>%
  set_colnames("page.rank")

## Pagerank of BioC packages in dg
head(pr[rownames(pr) %in% viewPkgs,,drop=FALSE], 25)

```

## SessionInfo

This vignette is based on work by Andrie de Vries 
at Microsoft's Algorithms and Data Science (ADS) team in London,
available from https://github.com/andrie/cran-network-structure
under the GPL 2.0

This page was created with the following packages:

```{r sessionInfo}
sessionInfo()
```
